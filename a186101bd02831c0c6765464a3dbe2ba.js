!function(e){"use strict";function t(e,t,i){var a,n,o,r,l,g,d=e.imageData(),c=t.imageData(),h=t.width(),u=t.height(),m=e.width(),s=m/h,f=e.height()/u;for(n=0;u>n;n++)for(a=0;h>a;a++)o=0|s*a,r=0|f*n,l=r*m+o<<2,g=n*h+a<<2,i&&3===n%4?(c.data[g]=d.data[l]>>1,c.data[g+1]=d.data[l+1]>>1,c.data[g+2]=d.data[l+2]>>1,c.data[g+3]=d.data[l+3]):(c.data[g]=d.data[l],c.data[g+1]=d.data[l+1],c.data[g+2]=d.data[l+2],c.data[g+3]=d.data[l+3]);t.imageData(c)}function i(e,t){n.LoadImage(e,t,function(t){e.parentNode.replaceChild(t.domEl(),e)})}var a,n=e.RetroCanvas={},o=window.devicePixelRatio||1,r="getImageData",l="putImageData";!function(){var e=document.createElement("canvas"),t=e.getContext("2d");a=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.backingStorePixelRatio||1,console.log("backingStorePixelRatio=",a,"devicePixelRatio=",o),1!==a&&(r="webkitGetImageDataHD",l="webkitPutImageDataHD"),t=null,e.width=0,e.height=0,e=null}();var g=1===a&&o>1;n.isRetina=1!==a||1!==o,n.Create=function(e,t){function i(){if(g){var e=1/o;d.style.width=(0|d.width*e)+"px",d.style.height=(0|d.height*e)+"px"}}function n(e,t){d.width=e/a,d.height=t/a,i()}var d=document.createElement("canvas"),c=d.getContext("2d");"boolean"==typeof c.webkitImageSmoothingEnabled&&(c.webkitImageSmoothingEnabled=!1),"boolean"==typeof c.mozImageSmoothingEnabled&&(c.mozImageSmoothingEnabled=!1),"boolean"==typeof c.imageSmoothingEnabled&&(c.imageSmoothingEnabled=!1),"number"==typeof e&&"number"==typeof t&&n(e,t);var h={domEl:function(){return d},ctx:function(){return c},width:function(){return 0|d.width*a},height:function(){return 0|d.height*a},resize:n,destroy:function(){h.resize(0,0),"function"==typeof d.remove&&d.remove(),c=h.ctx=void 0,d=h.domEl=void 0}};return h.loadImage=function(e,t){var i;e instanceof Image||e instanceof HTMLImageElement?i=e:(i=new Image,i.src=e),i.onload=function(){h.resize(i.width,i.height),c.drawImage(i,0,0,d.width,d.height),"function"==typeof t&&t(h)}},h.imageData=function(e){return e?(c[l](e,0,0),void 0):c[r](0,0,h.width(),h.height())},h.scaledByElementStyle=g,h.scaledByBackingStore=1!==a,h},n.LoadImage=function(e,i,r){var l=arguments[arguments.length-1],g=("function"==typeof i?1:i||1)*(o/a),d=n.Create();return n.Create().loadImage(e,function(e){var i=e.width()*g,n=e.height()*g;d.resize(i*a,n*a),d.pixelInfo={viewSize:[0|g*e.width()/o,0|g*e.height()/o],originalImageSize:[e.width(),e.height()],canvasSize:[i,n],realPixelSize:[d.width(),d.height()]},t(e,d,r===!0),e.destroy(),"function"==typeof l&&l(d)}),d},n.ReplaceImage=function(e,t){e.jquery?e.each(function(){i(this,t)}):i(e,t)},n.PixelBuffer={},n.PixelBuffer.Create=function(e,t){var i=new Array(e*t),a={getWidth:function(){return e},getHeight:function(){return t},getPixel:function(t,a){return i[a*e+t]},setPixel:function(t,a,n){return i[a*e+t]=n,n},fillRect:function(t,a,n,o,r){var l,g;for(g=a;o>g;g++)for(l=t;n>l;l++)i[g*e+l]=r}};return a.fillRect(0,0,e,t,0),a}}(this),jQuery(function(e){function t(e){i.append(e+"<br>")}console.log("hello RetroCanvas.js!");var i=e("#log"),a="assets/stone-level0.png";RetroCanvas.LoadImage(a,2,function(t){e("section").append(t.domEl())}),RetroCanvas.LoadImage(a,3,!0,function(i){window.c=i,console.log(i),e("section").append(i.domEl()),console.log("domEl:",i.domEl());var a=i.pixelInfo;t("viewSize: "+a.viewSize[0]+"x"+a.viewSize[1]),t("canvasSize: "+a.canvasSize[0]+"x"+a.canvasSize[1]),t("originalImageSize: "+a.originalImageSize[0]+"x"+a.originalImageSize[1]),t("realPixelSize: "+a.realPixelSize[0]+"x"+a.realPixelSize[1]),t("isRetina: "+(RetroCanvas.isRetina?"yes":"no")),t("scaledByElementStyle: "+(i.scaledByElementStyle?"yes":"no")),t("scaledByBackingStore: "+(i.scaledByBackingStore?"yes":"no"))}),RetroCanvas.isRetina&&RetroCanvas.ReplaceImage(e("#originalImage"),1)}),function(e){var t=e.TMX={VERSION:"0.0.1",Map:{},TileLayer:{},TileSet:{}};t.TileLayer.Create=function(){},t.TileSet.Create=function(){},t.Map.Create=function(e){if("orthogonal"!==e.orientation.toLowerCase())throw new Error("unsupported tmx orientation type '"+e.orientation+"'");var t={width:e.width,height:e.height,tileWidth:e.tilewidth,tileHeight:e.tileheight,pxWidth:e.width*e.tilewidth,pxHeight:e.height*e.tileheight};return t}}(this),jQuery(function(e){console.log("hello tmx.js!"),e.getJSON("assets/dungeon0.json",function(e){window.tmxMap=TMX.Map.Create(e),console.log(window.tmxMap)})});
;